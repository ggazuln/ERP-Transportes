{% extends 'layout.html' %}
{% from 'components/form_macros.html' import render_field, render_select_field, render_checkbox, render_submit %}

{% block title %}{{ title }}{% endblock %}

{% block content_header %}
<section class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1>{{ title }}</h1>
      </div>
      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-right">
          <li class="breadcrumb-item"><a href="{{ url_for('dashboard.show_dashboard') }}">Inicio</a></li>
          <li class="breadcrumb-item"><a href="{{ url_for('personal.index') }}">Personal</a></li>
          <li class="breadcrumb-item active">{{ legend }}</li>
        </ol>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block content %}
<div class="card card-primary shadow-sm">
  <div class="card-header">
    <h3 class="card-title">{{ legend }}</h3>
  </div>
  <form method="POST" enctype="multipart/form-data" novalidate>
    {{ form.hidden_tag() }}
    <div class="card-body">
      
      <h5 class="mb-3 mt-2 text-muted"><i class="fas fa-user me-2"></i>Información Personal</h5>
      <div class="row">
        <div class="col-md-6">{{ render_field(form.nombre, class="form-control") }}</div>
        <div class="col-md-6">{{ render_field(form.apellido, class="form-control") }}</div>
      </div>
      <div class="row mt-3">
        <div class="col-md-6">{{ render_field(form.rut, class="form-control") }}</div>
        <div class="col-md-6">{{ render_field(form.email, class="form-control") }}</div>
      </div>
      <div class="row mt-3">
        <div class="col-md-12">{{ render_field(form.direccion, class="form-control") }}</div>
      </div>
      <div class="row mt-3">
        <div class="col-md-4">{{ render_field(form.celular_personal, class="form-control") }}</div>
        <div class="col-md-4">{{ render_field(form.celular_contacto, class="form-control") }}</div>
        <div class="col-md-4">{{ render_field(form.persona_contacto, class="form-control") }}</div>
      </div>

      <hr>
      <h5 class="mb-3 mt-4 text-muted"><i class="fas fa-briefcase me-2"></i>Información Laboral y Documentos</h5>
      <div class="row">
        <div class="col-md-6">{{ render_select_field(form.cargo_id, class="form-select") }}</div>
        <div class="col-md-6">{{ render_field(form.firma_imagen, class="form-control") }}</div>
      </div>
      <div class="row mt-3">
        <div class="col-md-6">{{ render_field(form.fecha_vencimiento_licencia, class="form-control", type="date") }}</div>
        <div class="col-md-6">{{ render_field(form.fecha_vencimiento_cedula, class="form-control", type="date") }}</div>
      </div>

      <hr>
      <h5 class="mb-3 mt-4 text-muted"><i class="fas fa-cogs me-2"></i>Configuración del Sistema</h5>
      <div class="row">
        <div class="col-md-3">{{ render_checkbox(form.activo) }}</div>
        <div class="col-md-3">{{ render_checkbox(form.tiene_login, id='tiene_login') }}</div>
      </div>

      <div id="login-fields" style="display: {{ 'block' if form.tiene_login.data else 'none' }};">
        <h5 class="mb-3 mt-4 text-muted"><i class="fas fa-key me-2"></i>Datos de Acceso</h5>
        <div class="row">
          <div class="col-md-4">{{ render_field(form.username, class="form-control") }}</div>
          <div class="col-md-4">{{ render_field(form.password, class="form-control") }}</div>
          <div class="col-md-4">{{ render_field(form.confirm_password, class="form-control") }}</div>
        </div>
        <div class="row mt-3">
          <div class="col-md-6">{{ render_select_field(form.rol_id, class="form-select") }}</div>
        </div>
      </div>
    </div>

    <div class="card-footer">
      {{ render_submit(form.submit, class="btn btn-primary") }}
      <a href="{{ url_for('personal.index') }}" class="btn btn-secondary">Cancelar</a>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const tieneLoginCheckbox = document.getElementById('tiene_login');
  const loginFieldsDiv = document.getElementById('login-fields');

  function toggleLoginFields() {
    loginFieldsDiv.style.display = tieneLoginCheckbox.checked ? 'block' : 'none';
  }

  tieneLoginCheckbox.addEventListener('change', toggleLoginFields);
});
</script>
{% endblock %}
